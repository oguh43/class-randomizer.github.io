<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Randomizer</title>
    </head>
    <body>
        <div id="container">

        </div>
        <br><br>
        <input type="text" id="in">
        <br>
        <p id="out"></p>
    </body>
    <script>
        localStorage.clear()
        let origTime = + new Date()
        localStorage.setItem(origTime-new Date().toLocaleDateString().split("").reduce((s,l)=>{return s + l.charCodeAt(0)},0),1)
        let tried = ""

        let container = document.getElementById("container")
        let classData = {
            0: "Andrea",
            1: "Vanessa",
            2: "Tamara",
            3: "Michaela",
            4: "Ella",
            5: "Sára",
            6: "Ingrid",
            7: "Mária",
            8: "Patrícia",
            9: "Natália B.",
            10: "Bibiana G.",
            11: "Bibiana S.",
            12: "Empty",
            13: "Ondrej",
            14: "Martin",
            15: "Matúš",
            16: "Mário",
            17: "Jakub",
            18: "Štefan",
            19: "Lukáš",
            20: "Filip",
            21: "Hugo",
            22: "Natália O.",
            23: "Nicole"
        }
        let disabled = {}
        function renderClass(classData,disable = {},d_disable={}){
            let buffer = ""
            disabled = {}
            for (let i=0;i<=10;i+=2){
                buffer += `<tr><td><button id="${i}" onclick="toggleButton(this)">${classData[i]}</button></td><td><button id="${i+1}" onclick="toggleButton(this)">${classData[i+1]}</button></td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>${(typeof classData[i+2+10]=="undefined")?"&nbsp;":`<button id="${i+2+10}" onclick="toggleButton(this)">${classData[i+2+10]}</button>`}</td><td>${(typeof classData[i+3+10]=="undefined")?"&nbsp;":`<button id="${i+3+10}" onclick="toggleButton(this)">${classData[i+3+10]}</button>`}</td></tr>`
            }
            container.innerHTML = `<table>${buffer}</table><br><button onclick="randomize()">Randomize</button><button onclick="reset()">Reset</button><button id="rig">Rig</button>`
            document.getElementById("rig").addEventListener("click",()=>{
                    let resp = prompt("Goodbye World!")
                    if (localStorage.getItem(origTime-resp.split("").reduce((s,l)=>{return s + l.charCodeAt(0)},0)) === null||resp === new Date().toLocaleDateString()){
                        if (resp !== new Date().toLocaleDateString()){
                            if (tried==""){
                                tried = resp
                            }
                        }
                        if (tried==resp&&tried!==""){
                            alert("Silent rig activated, press randomize!")
                        }else{
                            alert("Wrong password!")
                        }
                        return
                    }
                    let temp = [classData[5],classData[13],classData[21]]
                    classData[5] = classData[11]
                    classData[11] = temp[0]
                    classData[21] = classData[10]
                    classData[10] = temp[2]
                    classData[13] = classData[17]
                    classData[17] = temp[1]
                    randomize({10:classData[10],11:classData[11],13:classData[13]})
            })
            if (Object.keys(disable).length < 0){
                return
            }
            Object.keys(disable).forEach(key=>{
                if (!(Object.keys(d_disable).includes(key))){
                    document.getElementById(key).style.background = "#ff0000"
                }
            })
        }
        function toggleButton(target){
            target.style.background = (target.style.background=="")?"#ff0000":""
        }
        function randomize(d_disabled={}){
            disabled = {...d_disabled, ...disabled}
            const choice = ()=>{
                let random = Math.floor(Math.random() * available.length)
                return available.splice(random, 1)[0]
            }
            for (let i=0;i<=21;i++){
                if (document.getElementById(i).style.background == "rgb(255, 0, 0)"){
                    if (!(Object.keys(d_disabled).includes(i))){
                        disabled[i] = document.getElementById(i).innerText
                    }
                }
            }
            let available = Object.keys(classData).filter(item => !Object.keys(disabled).includes(item))
            let copy = JSON.parse(JSON.stringify(disabled))
            len = available.length
            c_available = JSON.parse(JSON.stringify(available))
            for (let i=0;i<len;i++){
                copy[choice()] = classData[c_available[i]]
            }
            classData = copy
            renderClass(copy,disabled,d_disabled)
        }
        function reset(){
            classData = {
                0: "Andrea",
                1: "Vanessa",
                2: "Tamara",
                3: "Michaela",
                4: "Ella",
                5: "Sára",
                6: "Ingrid",
                7: "Mária",
                8: "Patrícia",
                9: "Natália B.",
                10: "Bibiana G.",
                11: "Bibiana S.",
                12: "Empty",
                13: "Ondrej",
                14: "Martin",
                15: "Matúš",
                16: "Mário",
                17: "Jakub",
                18: "Štefan",
                19: "Lukáš",
                20: "Filip",
                21: "Hugo",
                22: "Natália O.",
                23: "Nicole"
            }
            renderClass(classData)
        }
        renderClass(classData)
        document.getElementById("in").addEventListener("keyup",(e)=>{
            document.getElementById("out").innerText = e.target.value.split("").reduce((s,l)=>{return s + l.charCodeAt(0)},0)
        })
    </script>
</html>